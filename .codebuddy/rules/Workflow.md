---
description: 当用户发送Github PR链接、要求审查代码、或需要提交代码、发起PR时
alwaysApply: false
---

## 代码审查要点
- 代码和注释是否符合项目规范
- 实现是否符合预期，边界条件是否处理
- 是否存在重复代码或可合并的相似逻辑
- 是否有性能瓶颈或线程安全问题
- 是否符合接口的用法意图和最佳实践
- 公开接口变更要重点关注必要性
- 结合关联代码评估整体设计合理性，考虑是否需扩大重构范围
- 以上仅为重点关注项，应结合实际情况补充其他问题

## Git 规范

### 分支命名
- 格式：`feature/{username}_模块名` 或 `bugfix/{username}_模块名`
- 模块名用下划线连接，最多两个单词，如 `feature/domchen_layer_content`

### Commit 信息
- 120 字符内的英语概括，以英文句号结尾，中间无其他标点
- 侧重描述用户可感知的变化：公开接口调整、性能优化等

### 提交限制
- **禁止在 main 分支直接提交推送代码，必须通过 PR 流程**

## 发起 PR 流程
1. 运行 `./codeformat.sh` 格式化代码，忽略输出的报错，只要运行就会完成格式化
2. 按代码审查要点自审本地变更
3. 输出以下内容供用户确认：
   - **分支名称**：格式同上述分支命名规范
   - **PR 标题**：英语，格式同上述 Commit 信息要求
   - **PR 描述**：中文简要说明变更内容
4. 确认后创建分支、推送代码、执行 `gh pr create`，**逐字复制确认过的标题和描述，禁止添加任何格式或内容**
5. 补充提交使用正常追加，禁止 force push

## Review PR 流程
1. 用 `gh` 命令获取 PR 变更和评论，结合本地代码理解上下文
2. 输出变更总结和优化后的 PR 标题
3. 按代码审查要点逐项检查
4. 验证已有评论是否真正修复（重点关注我提过的评论）
5. 新问题或未解决问题带序号汇总，经用户确认后添加**中文行级评论**

### 行级评论格式
- 仅允许行级评论，禁止用 `gh pr comment`
- 使用 `gh api` 配合 `--input -` 和 heredoc 传递 JSON
```bash
gh api repos/{owner}/{repo}/pulls/{pr}/reviews --input - <<'EOF'
{"commit_id":"HEAD_SHA","event":"COMMENT","comments":[{"path":"文件路径","line":行号,"side":"RIGHT","body":"内容"}]}
EOF
```

