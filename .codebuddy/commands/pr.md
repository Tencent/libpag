---
description: 发起 PR - 格式化代码并提交 PR
---

# 发起 PR 流程

严格按以下步骤顺序执行：

---

## 步骤 1：确定提交范围

```bash
git diff --cached --stat
git diff --stat
```

根据暂存区和工作区状态判断：

| 暂存区 | 工作区 | 处理方式 |
|--------|--------|----------|
| 有内容 | 有内容 | 询问用户：只提交暂存区内容，还是提交全部变更 |
| 有内容 | 无内容 | 直接使用暂存区内容 |
| 无内容 | 有内容 | 使用 `git add .` 添加全部变更 |
| 无内容 | 无内容 | 提示无变更可提交，终止流程 |

记录本步骤确定的提交范围（全部变更 / 仅暂存区）和暂存区涉及的文件列表。

---

## 步骤 2：格式化代码

```bash
./codeformat.sh
```

忽略输出的报错信息，只要运行就会完成格式化。

格式化后处理：
- 如果步骤 1 确定提交**全部变更**：执行 `git add .`
- 如果步骤 1 确定只提交**暂存区内容**：检查格式化产生的变更，将步骤 1 记录的暂存区文件相关的格式化修改加入暂存区（`git add {文件}`）

---

## 步骤 3：输出 PR 信息供用户确认

用 `git status`、`git diff --cached` 查看将要提交的内容，输出以下信息供用户确认：

- **分支名称**：`feature/{username}_模块名` 或 `bugfix/{username}_模块名`（模块名用下划线连接，最多两个单词）
- **PR 标题**：英语，120 字符内，以句号结尾，侧重描述用户可感知的变化
- **PR 描述**：中文，简要说明变更内容和目的

**必须等待用户明确确认后才能继续。**

---

## 步骤 4：创建分支、推送代码、发起 PR

用户确认后，依次执行：

```bash
git checkout -b {分支名称}
git commit -m "{PR标题}"
git push -u origin {分支名称}
gh pr create --title "{PR标题}" --body "{PR描述}"
```

**禁止重新编写 PR 标题和描述**，必须使用步骤 3 中用户确认的内容。

完成后输出 PR 链接。

---

## 重要限制

- **禁止**在 main 分支直接提交推送代码
- **禁止** force push
